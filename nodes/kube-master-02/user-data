#cloud-config

hostname: kube-master-02

chpasswd:
  expire: false
  list:
  - ubuntu:$UBUNTU_PASSWORD

# Enable password authentication with the SSH daemon
ssh_pwauth: false

ssh_authorized_keys:
  - $UBUNTU_AUTHORIZED_KEY

## Update apt database and upgrade packages on first boot
package_update: true
package_upgrade: true

packages:
- curl
- wget
- htop

runcmd:
- ln -sfn /run/systemd/resolve/resolv.conf /etc/resolv.conf
- sync
- reboot -f
- sed -i '/^127\.0\.0\.1\s/s/$/ '"localhost kube-master-02"'/' /etc/hosts
- sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config